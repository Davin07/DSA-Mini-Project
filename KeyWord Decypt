#include<stdbool.h>
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<ctype.h>

void append(char* s, char c) 
{
        int len = strlen(s);
        s[len] = c;
        s[len+1] = '\0';
}


char dec[200], ciphertext[200], enc[200];

void keydec(char enc[], char key[])
{
    int i;
    char ch;
    bool arr[26] = {0};
    
    for(i = 0; i < strlen(key); i++)
    {
		ch = key[i];
        if(ch >= 'A' && ch <= 'Z')
        {
            if(arr[ch - 'A'] == 0)
            {
                //ciphertext[i] = ch;
                append(ciphertext, ch);
                arr[ch - 'A'] = 1;
            }
        }
        else if (ch >= 'a' && ch <= 'z')
        {
            if (arr[ch - 'a'] == 0) 
            { 
                //ciphertext[i] = ch - 32;
                append(ciphertext, ch-32);
                arr[ch - 'a'] = 1; 
            } 
        } 
    } 
  

    for (i=0; i<26; i++) 
    { 
        if(arr[i] == 0) 
        { 
            arr[i]=1; 
            //ciphertext[i] = (char)(i+65);
            append(ciphertext, (char)(i+65));
        } 
    } 
	ciphertext[i] = '\0';
    
    
    char plaintext[] = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
	int pos;
	char ch1, ence[100];
    
	for(i=0; i < strlen(ciphertext); i++) 
    { 
        ence[ciphertext[i]]=i; 
    } 
  
	for(i = 0; i < strlen(enc); i++)
	{
		ch1 = enc[i];
		if(isalpha(enc[i]))
		{
			if(ch1 >= 'a' && ch1 <= 'z')
			{
				pos = ence[ch1 - 97];	
				append(dec, plaintext[pos]);
			}
			else if(ch1 >= 'A' && ch1 <= 'Z')
			{
				pos = ence[ch1];
				append(dec, plaintext[pos]);	
			}
		}
		else
		{
			dec[i] = ch1;
		}
	}
	puts(dec);
}


void main()
{
   char key[100];
   printf("Enter the encrypted message \n");
   gets(enc);
   printf("Enter the key \n");
   gets(key);
   keydec(enc, key); 
}
